<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kubernetes API Timeline</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <style>
    .apigroup>.name,
    .apiversion>.name,
    .apigroup td.release,
    td.scope {
      /* font-family: monospace; */
      line-height: 150%;
    }

    thead .release a {
      border-bottom: 1px dashed #616a74;
      cursor: help;
    }

    .hidden {
      display: none;
    }

    /* make enough room to fit the fixed footer into the layout */
    .site-container {
      margin-bottom: 100px;
    }

    .apigroup>.name {
      text-align: left;
      padding-left: 5px;

      /* make sure the icons do not slip into a new line */
      white-space: nowrap;
    }

    .apigroup>.release {
      text-align: center;
    }

    .apiversion {
      font-size: 90%;
    }

    .apiversion>.name {
      text-align: left;
      font-weight: normal;
      padding-left: 20px;
    }

    .apiversion>.release {
      text-align: center;
    }

    .apiversion>.release.exists {
      background: #ffc107;
      color: black;
    }

    .apiversion>.release.exists.preferred {
      background: #198754;
    }

    .release {
      text-align: center;
    }

    .apiresource {
      font-size: 90%;
    }

    .apiresource>.name {
      text-align: left;
      font-weight: normal;
      padding-left: 40px;

      /* make sure the icons do not slip into a new line */
      white-space: nowrap;
    }

    /* combat bootstrap's large padding */
    .table tbody td,
    .table tbody th {
      padding: .2rem .2rem;
    }

    /* fix missing table borders in Firefox */
    /* thanks to https://stackoverflow.com/a/58319944 */
    .table tbody th {
      background-clip: padding-box;
    }

    td.release {
      padding: .2rem 0 !important;
    }

    td.release>span {
      display: inline-block;
      width: 100%;
      font-weight: normal;
    }

    td.a10y-middle>span {
      border-radius: 0 !important;
    }

    td.a10y-begin>span {
      border-top-right-radius: 0 !important;
      border-bottom-right-radius: 0 !important;
    }

    td.a10y-end>span {
      border-top-left-radius: 0 !important;
      border-bottom-left-radius: 0 !important;
    }

    td.a10y-begin.a10y-end>span {
      border-top-right-radius: 0.375rem !important;
      border-bottom-right-radius: 0.375rem !important;
      border-top-left-radius: 0.375rem !important;
      border-bottom-left-radius: 0.375rem !important;
    }

    /* hide cell text for api resources (looks noisy) and apiversion (preferred-status is visible by colors) */
    .apiversion td.release span,
    .apiresource td.release span {
      text-indent: -9999px;
    }

    /* for API groups there is exists/stable/issing */
    .apigroup td.release.a10y-exists span {
      background-color: #198754;
      color: #bffce0;
    }

    .apigroup td.release.a10y-exists.maturity-prerelease span {
      background-color: #1c5f42;
    }

    /* for API versions there is exists/preferred/missing */
    .apiversion td.release.a10y-exists span {
      background-color: #ffc107;
      color: black;
    }

    .apiversion td.release.a10y-preferred span {
      background-color: #198754;
      color: white;
    }

    /* for API resources there is also exists/preferred/missing */
    .apiresource td.release.a10y-exists span {
      background-color: #ffc107;
      color: black;
    }

    .apiresource td.release.a10y-preferred span {
      background-color: #198754;
      color: white;
    }

    a.toggle, a.docs {
      color: rgb(178, 178, 178);
      font-weight: normal;
      text-decoration: none;
    }

    .apiresource .icons {
      /* make the icons for resources a bit less prominent to reduce visual clutter */
      opacity: 0.5;

      /* move icons a bit away from the text */
      padding-left: 5px;
    }

    .apiresource:hover .icons {
      opacity: 1;
    }

    /* if an APIGroup is collapsed, hide all rows except for the group's row in it */
    tbody.collapsed tr.apiversion,
    tbody.collapsed tr.apiresource {
      display: none;
    }

    /* if an APIVersion is collapsed, the hiddenness will be applied via JavaScript */
    /* if an APIResource is hidden, hide it (there is already a .hidden rule) */

    /* page footer */
    footer {
      font-size: 75%;

      /* make the footer independent from the megatable, so scrolling horizontally works better */
      position: fixed;
      width: 100%;
      bottom: 0;

      /* make sure the footer is hidden behind the table when scrolling */
      z-index: -1;
    }

    footer .border-top {
      padding-top: 1rem;
      margin-bottom: 0.5rem;
    }

    /* make the header row stick to the top of the screen when scrolling */
    /* note that this would interfere with bootstrap's table-responsive */
    .release-megatable thead th {
      position: sticky;
      top: 0;
      z-index: 1;
    }

    /* and make the left column stick to the side of the screen */
    .release-megatable thead th,
    .release-megatable tbody th.name {
      position: sticky;
      left: 0;
    }

    /* mark currently supported Kubernetes releases */
    td.release-supported, th.release-supported {
      background: #1c5f4275;
    }
    td.oldest-release-supported, th.oldest-release-supported {
      border-left: 1px solid #495057;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Kubernetes API Timeline</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Link</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" aria-disabled="true">Disabled</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- the main page container -->
  <main class="site-container">

    <!-- This 2 column div contains the mega table; it's two columns so that the right side table -->
    <!-- can be a responsive table and get horizontal scrolling while keeping the left column fixed. -->
    <table class="table release-megatable">
      <thead>
        <tr>
          <th>&nbsp;</th>
          {{ range $idx, $rel := .Timeline.Releases }}
          <th
            class="{{ getReleaseHeaderClass $.Timeline $rel }}"
            data-release="{{ $rel.Version }}"
            data-latest-version="{{ $rel.LatestVersion }}"
            data-release-date="{{ $rel.ReleaseDate.Format "2006-01-02" }}"
            data-eol-date="{{ with $rel.EndOfLifeDate }}{{ .Format "2006-01-02" }}{{ end }}"
          >
            <a tabindex="{{ $idx }}" role="button" data-bs-toggle="popover" data-release="{{ $rel.Version }}">{{ $rel.Version }}</a>
          </th>
          {{ end }}
        </tr>
      </thead>

      {{ range $apiGroup := .Timeline.APIGroups }}
      <tbody data-apigroup="{{ $apiGroup.Name }}" class="collapsed">
        <!-- row for the API group -->
        <tr class="apigroup">
          <th class="name">
            {{ $apiGroup.Name }}
            <span class="icons"><small><a href="#" class="toggle" title="expand/collapse this API group">⊕</a></small></span>
          </th>
          {{ range $rel := $.Timeline.Releases }}
          <td class="{{ getAPIGroupReleaseClass $.Timeline $apiGroup $rel }}">
            <span class="badge text-bg">{{ $apiGroup.PreferredVersion $rel.Version }}</span>
          </td>
          {{ end }}
        </tr>

        {{ range $apiVersionIdx, $apiVersion := $apiGroup.APIVersions }}
        <!-- row for the API version -->
        <tr class="apiversion collapsed" data-apiversion="{{ $apiVersion.Version }}">
          <th class="name">
            <span class="hidden">{{ $apiGroup.Name }}/</span>{{ $apiVersion.Version }}
            <span class="icons"><small><a href="#" class="toggle" title="expand/collapse this API version">⊕</a></small></span>
          </th>
          {{ range $rel := $.Timeline.Releases }}
          <td class="{{ getAPIVersionReleaseClass $.Timeline $apiGroup $apiVersion $rel }}">
            <span class="badge text-bg">{{ getAPIVersionReleaseContent $.Timeline $apiGroup $apiVersion $rel }}</span>
          </td>
          {{ end }}
        </tr>

        {{ range $apiResource := $apiVersion.Resources }}
        <!-- row for an API resource -->
        <tr class="apiresource" data-apiversion="{{ $apiVersion.Version }}" data-apiresource="{{ $apiResource.Plural }}">
          <th class="name">
            <span title="{{ $apiResource.Description }}">{{ $apiResource.Kind }}</span>
            <span class="icons"><small><a href="#" class="docs" title="view documentation for most recent Kubernetes release">⛿</a></small></span>
          </th>
          {{ range $rel := $.Timeline.Releases }}
          <td class="{{ getAPIResourceReleaseClass $.Timeline $apiGroup $apiVersion $apiResource $rel }}">
            <span class="badge text-bg">{{ getAPIResourceReleaseContent $.Timeline $apiGroup $apiVersion $apiResource $rel }}</span>
          </td>
          {{ end }}
        </tr>
        {{ end }}
        {{ end }}
      </tbody>
      {{ end }}
    </table>
  </main> <!-- main content done -->

  <footer>
    <p class="text-center text-body-secondary border-top">
      Distributed under CC BY 4.0
    </p>
    <p class="text-center text-body-secondary">
      Kubernetes® is a registered trademark of The Linux Foundation®. All rights reserved.<br>
      This website has no relation with and is not endorsed by The Linux Foundation.
    </p>
  </footer>

  <div class="hidden">
    <div class="release-popover-template">
      <div class="container">
        <div class="row">
          <div class="col">Released:</div>
          <div class="col release-date"></div>
        </div>
        <div class="row">
          <div class="col">Latest:</div>
          <div class="col latest-version"></div>
        </div>
        <div class="row">
          <div class="col">End of Life:</div>
          <div class="col eol-date"></div>
        </div>
      </div>

      <ul class="release-links">
        <li><a href="#" class="release-documentation" target="_blank">📖 Documentation</a></li>
        <li><a href="#" class="release-changelog" target="_blank">G Changelog</a></li>
        <li><a href="#" class="release-gitbranch" target="_blank">G Git Branch</a></li>
      </ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script>
    function showReleaseInfoPopover(link) {
      let cell = link.closest('th');
      let release = cell.dataset.release;
      let template = document.querySelector('.release-popover-template').cloneNode(true);

      template.querySelector('.release-date').innerText = cell.dataset.releaseDate;
      template.querySelector('.latest-version').innerText = cell.dataset.latestVersion;
      template.querySelector('.eol-date').innerText = cell.dataset.eolDate;

      template.querySelector('.release-changelog').href = `https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-${release}.md`;
      template.querySelector('.release-gitbranch').href = `https://github.com/kubernetes/kubernetes/tree/release-${release}`;

      return template.innerHTML;
    }

    const popoverTriggerList = document.querySelectorAll('thead th.release [data-bs-toggle="popover"]')
    const popoverList = [...popoverTriggerList].map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl, {
        html:      true,
        content:   showReleaseInfoPopover,
        placement: 'bottom',
        trigger:   'focus',
      });
    });

    // tbodies cannot be nested, so besides 1 tbody per APIGroup, there is no
    // further nesting in the megatable; but APIResources should still logically
    // be grouped below APIVersions, so to simulate this, we have to manually
    // apply the "hidden" class for all APIResources which have their APIVersion
    // collapsed;
    // This "hidden" class has then also be kept in-sync with the collapsed status.
    function updateAPIResourcesVisibility(apiversionRow) {
      let isCollapsed     = apiversionRow.classList.contains("collapsed");
      let apiVersion      = apiversionRow.dataset.apiversion;
      let apiGroupBody    = apiversionRow.closest('tbody');
      let apiResourceRows = apiGroupBody.querySelectorAll('tr.apiresource[data-apiversion="' + apiVersion + '"]');

      apiResourceRows.forEach(function(row) {
        row.classList.toggle("hidden", isCollapsed);
      });
    }

    // initial setup
    document.querySelectorAll('tr.apiversion').forEach(updateAPIResourcesVisibility);

    // toggle visibility of APIVersions for an APIGroup
    document.querySelectorAll('tr.apigroup a.toggle').forEach(function(node) {
      node.addEventListener("click", function(e) {
        let apigroupRow  = this.closest('tr');
        let apigroupBody = apigroupRow.closest('tbody');
        let apigroup     = apigroupBody.dataset.apigroup;

        // toggle visibility in legend table
        apigroupBody.classList.toggle("collapsed");

        // update icon
        this.innerText = apigroupBody.classList.contains("collapsed") ? '⊕' : '⊙';

        e.preventDefault();
      });
    });

    // toggle visibility of APIResources for an APIVersion
    document.querySelectorAll('tr.apiversion a.toggle').forEach(function(node) {
      node.addEventListener("click", function(e) {
        let apiversionRow = this.closest('tr');
        let apiversion    = apiversionRow.dataset.apiversion;
        let apigroupBody  = apiversionRow.closest('tbody');
        let apigroup      = apigroupBody.dataset.apigroup;

        // toggle visibility in legend table
        apiversionRow.classList.toggle("collapsed");
        updateAPIResourcesVisibility(apiversionRow);

        // update icon
        this.innerText = apiversionRow.classList.contains("collapsed") ? '⊕' : '⊙';

        e.preventDefault();
      });
    });
  </script>
</body>

</html>
